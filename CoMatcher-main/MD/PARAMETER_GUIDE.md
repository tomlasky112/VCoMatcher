# âš™ï¸ VCoMatcher Phase 1 å‚æ•°å®Œå…¨æŒ‡å—

**ç‰ˆæœ¬**: v1.2 (å«v1.6 pnp_tauå‚æ•°)  
**æ—¥æœŸ**: 2025-12-22

---

## ğŸ¯ æ ¸å¿ƒå‚æ•°

### pnp_tauï¼ˆPnPä¼˜åŒ–é˜ˆå€¼ï¼‰â­â­â­ æ–°å¢ (v1.6)

**é»˜è®¤å€¼**: `6.0`

**å«ä¹‰**: 
```python
# PnPä½å§¿ä¼˜åŒ–æ—¶ä½¿ç”¨çš„ç²¾è‹±ç‚¹é˜ˆå€¼ï¼ˆä¸¥æ ¼è¿‡æ»¤ï¼‰
# åªä½¿ç”¨æœ€é«˜è´¨é‡çš„ç‚¹è¿›è¡Œä½å§¿æ±‚è§£

valid_points = points_conf < pnp_tau
# ä¿ç•™ uncertainty < pnp_tau çš„ç‚¹ç”¨äºPnPä¼˜åŒ–
```

**èŒƒå›´**: [1, 10]ï¼Œæ¨è 5-8

**æ•ˆæœ**:
| é˜ˆå€¼ | ç‚¹æ•°é‡ | è´¨é‡ | ä¼˜åŒ–ç²¾åº¦ | ç”¨é€” |
|------|--------|------|----------|------|
| 3.0 | æå°‘ | æé«˜ | å¯èƒ½å¤±è´¥ | é«˜è´¨é‡æ•°æ® |
| **6.0** | **é€‚ä¸­** | **é«˜** | **æœ€ä¼˜** | **æ ‡å‡†ï¼ˆæ¨èï¼‰** |
| 8.0 | è¾ƒå¤š | ä¸­ç­‰ | è‰¯å¥½ | å™ªå£°æ•°æ® |
| 10.0 | å¾ˆå¤š | ä½ | å¯èƒ½å‘æ•£ | æç«¯å™ªå£° |

**âš ï¸ é‡è¦**: `pnp_tau` åº”è¯¥**è¿œå°äº** `tau_uncertainty`
```bash
# æ­£ç¡®é…ç½®
--pnp_tau 6.0          # PnPç”¨ç²¾è‹±ç‚¹
--tau_uncertainty 15.0 # Maskç”¨å®½æ¾é˜ˆå€¼

# é”™è¯¯é…ç½®ï¼ˆä¼šå¯¼è‡´PnPç‚¹ä¸è¶³ï¼‰
--pnp_tau 15.0         # å¤ªå®½æ¾
--tau_uncertainty 8.0  # å¤ªä¸¥æ ¼
```

**è°ƒä¼˜å»ºè®®**:
```bash
# é«˜è´¨é‡COLMAPæ•°æ®
--pnp_tau 5.0

# æ ‡å‡†åœºæ™¯ï¼ˆæ¨èï¼‰
--pnp_tau 6.0  # é»˜è®¤

# å™ªå£°æ•°æ®ï¼ˆVGGTä¼ªçœŸå€¼ï¼‰
--pnp_tau 8.0
```

---

### tau_uncertaintyï¼ˆä¸ç¡®å®šæ€§é˜ˆå€¼ï¼‰â­â­â­ æœ€é‡è¦

**é»˜è®¤å€¼**: `15.0`ï¼ˆv1.1 æ›´æ–°ï¼‰

**å«ä¹‰**: 
```python
# VGGT çš„ points_conf æ˜¯ Uncertainty [1, âˆ)
# å€¼è¶Šå°è¶Šç¡®å®šï¼Œå€¼è¶Šå¤§è¶Šä¸ç¡®å®š

mask_uncertainty = points_conf < tau_uncertainty
# ä¿ç•™ uncertainty < tau çš„åƒç´ ï¼ˆå³ç¡®å®šçš„åŒºåŸŸï¼‰
```

**èŒƒå›´**: [1, âˆ)ï¼Œæ¨è 10-20

**æ•ˆæœ**:
| é˜ˆå€¼ | è¦†ç›–ç‡ | mask_loss é¢„æœŸ | ç”¨é€” |
|------|-------|---------------|------|
| 3.0 | ~54% | ~45% | æä¸¥æ ¼ï¼ˆå®éªŒï¼‰|
| 5.0 | ~58% | ~50% | ä¸¥æ ¼ |
| 8.0 | ~61% | ~55% | ä¸­ç­‰ |
| **15.0** | **~74%** | **~65-70%** | **æ ‡å‡†ï¼ˆæ¨èï¼‰** |
| 20.0 | ~92% | ~80-85% | å®½æ¾ |

**é€‰æ‹©å»ºè®®**:
```bash
# é«˜è´¨é‡åœºæ™¯ï¼ˆçº¹ç†ä¸°å¯Œï¼‰
--tau_uncertainty 10.0

# æ ‡å‡†åœºæ™¯ï¼ˆæ¨èï¼‰
--tau_uncertainty 15.0  # é»˜è®¤

# å›°éš¾åœºæ™¯ï¼ˆçº¹ç†ç¼ºå¤±ï¼‰
--tau_uncertainty 20.0
```

---

### tau_maxï¼ˆè¿œå¹³é¢é˜ˆå€¼ï¼‰

**é»˜è®¤å€¼**: `100.0`

**å«ä¹‰**: è¿‡æ»¤æ·±åº¦ > tau_max çš„åƒç´ ï¼ˆé€šå¸¸æ˜¯å¤©ç©ºï¼‰

**æ¨èå€¼**:
```bash
# å®¤å†…åœºæ™¯
--tau_max 50.0

# ä¸€èˆ¬åœºæ™¯
--tau_max 100.0  # é»˜è®¤

# å®¤å¤–å¤§åœºæ™¯
--tau_max 200.0
```

---

### tau_minï¼ˆè¿‘å¹³é¢é˜ˆå€¼ï¼‰

**é»˜è®¤å€¼**: `0.1`

**å«ä¹‰**: è¿‡æ»¤æ·±åº¦ < tau_min çš„åƒç´ ï¼ˆå™ªå£°æˆ–æ— æ•ˆæ·±åº¦ï¼‰

**é€šå¸¸ä¸éœ€è¦ä¿®æ”¹**: `0.1` é€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯

---

### epsilon_consistï¼ˆä¸€è‡´æ€§é˜ˆå€¼ï¼‰

**é»˜è®¤å€¼**: `0.05`

**å«ä¹‰**: æ·±åº¦-ç‚¹äº‘ä¸€è‡´æ€§æ£€æŸ¥å®¹å¿åº¦

```python
|depth_from_D - depth_from_P| < epsilon_consist * depth
```

**è°ƒæ•´**:
```bash
# mask_loss å¤ªä½æ—¶å¯ä»¥æ”¾å®½
--epsilon_consist 0.08  # æˆ– 0.1
```

---

## ğŸ“Š å‚æ•°ç»„åˆç¤ºä¾‹

### é«˜è´¨é‡æ¨¡å¼

```bash
python vcomatcher_phase1_data_engine.py \
    --scene_dir ... \
    --tau_min 0.1 \
    --tau_max 50.0 \
    --tau_uncertainty 10.0 \
    --epsilon_consist 0.05
    
# é¢„æœŸ:
# mask_geom: 80-85%
# mask_loss: 55-60%
# è´¨é‡: é«˜
```

### æ ‡å‡†æ¨¡å¼ï¼ˆæ¨èï¼‰

```bash
python vcomatcher_phase1_data_engine.py \
    --scene_dir ... \
    --tau_min 0.1 \
    --tau_max 100.0 \
    --tau_uncertainty 15.0 \
    --epsilon_consist 0.05
    
# é¢„æœŸ:
# mask_geom: 85-90%
# mask_loss: 65-70%  âœ…
# è´¨é‡: ä¼˜ç§€
```

### æœ€å¤§æ ·æœ¬æ¨¡å¼

```bash
python vcomatcher_phase1_data_engine.py \
    --scene_dir ... \
    --tau_min 0.1 \
    --tau_max 200.0 \
    --tau_uncertainty 20.0 \
    --epsilon_consist 0.08
    
# é¢„æœŸ:
# mask_geom: 90-95%
# mask_loss: 75-80%
# è´¨é‡: è‰¯å¥½ï¼ˆåŒ…å«æ›´å¤šå›°éš¾æ ·æœ¬ï¼‰
```

---

## ğŸ“ å‚æ•°ç†è§£

### VGGT Uncertainty çš„ç‰¹æ®Šæ€§

```python
# âš ï¸  é‡è¦ï¼VGGT çš„ points_conf ä¸æ˜¯é€šå¸¸çš„ [0, 1] confidence!

points_conf = 1 + exp(x)  # æ¿€æ´»å‡½æ•°: expp1

å€¼åŸŸ: [1, âˆ)
è¯­ä¹‰: Uncertaintyï¼ˆä¸ç¡®å®šæ€§ï¼‰ï¼Œä¸æ˜¯ Confidence

å€¼è¶Šå° = è¶Šç¡®å®š = è¶Šå¥½
å€¼è¶Šå¤§ = è¶Šä¸ç¡®å®š = è¶Šå·®

å…¸å‹åˆ†å¸ƒ:
  æœ€å°å€¼: 1.0    (å®Œå…¨ç¡®å®š)
  ä¸­ä½æ•°: 2.0    (è¾ƒç¡®å®š)
  å¹³å‡å€¼: 7.0    (ä¸­ç­‰)
  P90:    15.0   (è¾ƒä¸ç¡®å®š)
  P99:    25.0   (å¾ˆä¸ç¡®å®š)
  æœ€å¤§å€¼: 30+    (å®Œå…¨ä¸ç¡®å®š)
```

### è¿‡æ»¤é€»è¾‘

```python
# âœ… æ­£ç¡®ï¼ˆv1.1ï¼‰:
mask = points_conf < tau_uncertainty
# ä¿ç•™ä½ uncertainty çš„åƒç´ 

# âŒ é”™è¯¯ï¼ˆv1.0ï¼‰:
mask = points_conf > tau_uncertainty  
# é€»è¾‘åäº†ï¼
```

---

## ğŸ“ˆ å‚æ•°è°ƒä¼˜æµç¨‹

### Step 1: æŸ¥çœ‹ Confidence åˆ†å¸ƒ

```bash
python diagnose_confidence.py --data_file scene.npz
```

æŸ¥çœ‹ï¼š
- ä¸­ä½æ•°ï¼ˆP50ï¼‰
- P75
- å¹³å‡å€¼

### Step 2: é€‰æ‹©é˜ˆå€¼

```
ç›®æ ‡ mask_loss è¦†ç›–ç‡: 65-70%

å¦‚æœ P75 â‰ˆ 8:  tau = 15
å¦‚æœ P75 â‰ˆ 12: tau = 20
å¦‚æœ P75 â‰ˆ 5:  tau = 10
```

### Step 3: ç”Ÿæˆå¹¶éªŒè¯

```bash
python vcomatcher_phase1_data_engine.py --tau_uncertainty <é€‰æ‹©çš„å€¼>
python diagnose_mask_breakdown.py --data_file scene.npz
```

æ£€æŸ¥ mask_loss æ˜¯å¦åœ¨ç›®æ ‡èŒƒå›´

---

## ğŸš€ å¿«é€Ÿå‘½ä»¤

### ä½¿ç”¨é»˜è®¤å‚æ•°ï¼ˆæ¨èï¼‰

```bash
# ç°åœ¨åªéœ€è¦æŒ‡å®šåœºæ™¯ï¼Œå…¶ä»–éƒ½æ˜¯ä¼˜åŒ–çš„é»˜è®¤å€¼
python vcomatcher_phase1_data_engine.py \
    --scene_dir ../../vggt-main/examples/kitchen \
    --output_dir ./data/vcomatcher_phase1_test

# æ‰€æœ‰å‚æ•°éƒ½å·²ä¼˜åŒ–ï¼š
# tau_min = 0.1
# tau_max = 100.0  
# tau_uncertainty = 15.0  âœ… æ–°é»˜è®¤å€¼
```

---

**æœ€åæ›´æ–°**: 2025-12-13  
**ä½œè€…**: VCoMatcher Team

